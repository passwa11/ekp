!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WebOfficeSDK={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,s)}c((r=r.apply(e,t||[])).next())})}function r(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var a,o,i,s=function(){function e(){}return e.add=function(t){e.HANDLE_LIST.push(t),window.addEventListener("message",t,!1)},e.remove=function(t){var n=e.HANDLE_LIST.indexOf(t);n>=0&&e.HANDLE_LIST.splice(n,1),window.removeEventListener("message",t,!1)},e.empty=function(){for(;e.HANDLE_LIST.length;)window.removeEventListener("message",e.HANDLE_LIST.shift(),!1)},e.parse=function(e){return"object"==typeof e?e:e?JSON.parse(e):e},e.HANDLE_LIST=[],e}();!function(e){e.unknown="unknown",e.spreadsheet="s",e.writer="w",e.presentation="p",e.pdf="f"}(a||(a={})),function(e){e.wps="w",e.et="s",e.presentation="p",e.pdf="f"}(o||(o={})),function(e){e.nomal="nomal",e.simple="simple"}(i||(i={}));var c,u,l=(c=0,function(){return c+=1}),p=function(e,t,n){void 0===n&&(n=!0);var r=t;if(!u){var a=function(e){u.style.cssText+="height: "+e.clientHeight+"px; width: "+e.clientWidth+"px"}.bind(null,r);(u=document.createElement("iframe")).classList.add("web-office-iframe");var o={id:"office-iframe",src:e,scrolling:"no",frameborder:"0",allowfullscreen:"allowfullscreen",webkitallowfullscreen:"true",mozallowfullscreen:"true"};for(var i in r?(o.style="width: "+r.clientWidth+"px; height: "+r.clientHeight+"px;",n&&window.addEventListener("resize",a)):((r=document.createElement("div")).classList.add("web-office-default-container"),function(e){var t=document.createElement("style");document.head.appendChild(t);var n=t.sheet;n.insertRule(e,n.cssRules.length)}(".web-office-default-container {position: absolute; padding: 0;  margin: 0; width: 100vw; height: 100vh; left: 0; top: 0;}"),document.body.appendChild(r),o.style="width: 100vw; height: 100vh;"),o)u.setAttribute(i,o[i]);r.appendChild(u),u.destroy=function(){u.parentNode.removeChild(u),u=null,window.removeEventListener("resize",a)}}return u};var d=function(e){p().contentWindow.postMessage(JSON.stringify(e),"*")};function f(e,t,n){return new Promise(function(r){var a=l(),o=function(e){var t=s.parse(e.data);t.eventName===n&&t.msgId===a&&(r(t.data),s.remove(o))};s.add(o),d({data:e,msgId:a,eventName:t})})}var v=function(e){return f(e,"wps.jssdk.api","wps.api.reply")},b=function(e){return f(e,"api.basic","api.basic.reply")},h=function(e,a,o,i){return n(void 0,void 0,void 0,function(){var c,u,p,f,v,b,h,w;return r(this,function(g){switch(g.label){case 0:return c=l(),f=new Promise(function(e,t){u=e,p=t}),v={},a.args?[4,m(a.args)]:[3,2];case 1:b=g.sent(),h=b[0],w=b[1],a.args=h,v=w,g.label=2;case 2:return function(e){var n=e[0],r=e[1];"function"==typeof(n=t({},n)).data&&(n.data=n.data());r(),d(n)}([{eventName:e,data:a,msgId:c},function(){var t=this,a=function(l){return n(t,void 0,void 0,function(){var t,n,f;return r(this,function(r){switch(r.label){case 0:return"api.callback"===(t=s.parse(l.data)).eventName&&t.callbackId&&v[t.callbackId]?[4,v[t.callbackId].apply(v,t.data.args)]:[3,2];case 1:n=r.sent(),d({result:n,eventName:"api.callback.reply",callbackId:t.callbackId}),r.label=2;case 2:return t.eventName===e+".reply"&&t.msgId===c&&(t.error?((f=new Error("")).stack=t.error+"\n"+o,i&&i(),p(f)):u(t.result),s.remove(a)),[2]}})})};return s.add(a),f}]),[2,f]}})})};function m(e){return n(this,void 0,void 0,function(){var t,n,a,o,i,s,c,u,p,d,f;return r(this,function(r){switch(r.label){case 0:t={},n=[],a=e.slice(0),r.label=1;case 1:return a.length?(o=void 0,[4,a.shift()]):[3,13];case 2:return(i=r.sent())&&i.done?[4,i.done()]:[3,4];case 3:r.sent(),r.label=4;case 4:if(!function(e){if(!e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(o))return[3,11];for(c in o={},s=[],i)s.push(c);u=0,r.label=5;case 5:return u<s.length?(p=s[u],d=i[p],/^[A-Z]/.test(p)?d&&d.done?[4,d.done()]:[3,7]:[3,8]):[3,10];case 6:r.sent(),r.label=7;case 7:d&&d.objId?d={objId:d.objId}:"function"==typeof d&&(f=l(),t[f]=d,d={callbackId:f}),r.label=8;case 8:o[p]=d,r.label=9;case 9:return u++,[3,5];case 10:return[3,12];case 11:i&&i.objId?o={objId:i.objId}:"function"==typeof i&&void 0===i.objId?(f=l(),t[f]=i,o={callbackId:f}):o=i,r.label=12;case 12:return n.push(o),[3,1];case 13:return[2,[n,t]]}})})}var w=function(e,n){void 0===n&&(n=!0);var r=t({},e),a=r.headers,o=void 0===a?{}:a,s=r.subscriptions,c=void 0===s?{}:s,u=r.mode,l=void 0===u?i.nomal:u,p=o.backBtn,d=void 0===p?{}:p,f=o.shareBtn,v=void 0===f?{}:f,b=o.otherMenuBtn,h=void 0===b?{}:b,m=function(e,t){e.subscribe&&"function"==typeof e.subscribe&&(e.callback=t,c[t]=e.subscribe,n&&delete e.subscribe)};if(m(d,"wpsconfig_back_btn"),m(v,"wpsconfig_share_btn"),m(h,"wpsconfig_other_menu_btn"),h.items&&Array.isArray(h.items)){var w=[];h.items.forEach(function(e,t){switch(void 0===e&&(e={}),e.type){case"export_img":e.type=1,e.callback="export_img";break;case"export_pdf":e.type=1,e.callback="export_pdf";break;case"save_version":e.type=1,e.callback="save_version";break;case"about_wps":e.type=1,e.callback="about_wps";break;case"split_line":e.type=2;break;case"custom":e.type=3,m(e,"wpsconfig_other_menu_btn_"+t),w.push(e)}}),w.length&&(I||k)&&(h.items=w)}if(r.url=r.url||r.wpsUrl,(l===i.simple||r.commonOptions&&!1===r.commonOptions.isShowTopArea)&&r.url&&(r.url+="&simple&hidecmb"),r.debug&&r.url&&(r.url+="&debugger"),r.wordOptions&&(r.wpsOptions=r.wordOptions),r.excelOptions&&(r.etOptions=r.excelOptions),r.pptOptions&&(r.wppOptions=r.pptOptions),"object"==typeof c.print){var g="wpsconfig_print";"function"==typeof c.print.subscribe&&(c[g]=c.print.subscribe,r.print={callback:g},void 0!==c.print.custom&&(r.print.custom=c.print.custom)),delete c.print}"function"==typeof c.exportPdf&&(c[g="wpsconfig_export_pdf"]=c.exportPdf,r.exportPdf={callback:g},delete c.exportPdf);return r.commandBars&&y(r.commandBars,!1),t(t({},r),{subscriptions:c})},g=function(e){void 0===e&&(e="");var t="";if(!t&&e){var n=e.toLowerCase();-1!==n.indexOf("/office/s/")&&(t=a.spreadsheet),-1!==n.indexOf("/office/w/")&&(t=a.writer),-1!==n.indexOf("/office/p/")&&(t=a.presentation),-1!==n.indexOf("/office/f/")&&(t=a.pdf)}if(!t){var r=e.match(/[\?&]type=([a-z]+)/)||[];t=o[r[1]]||""}return t};function y(e,t){void 0===t&&(t=!0);var n=e.map(function(e){var t=e.attributes;if(!Array.isArray(t)){var n=[];for(var r in t)if(t.hasOwnProperty(r)){var a={name:r,value:t[r]};n.push(a)}e.attributes=n}return e});return t&&d({data:n,eventName:"setCommandBars"}),n}var j=window.navigator.userAgent.toLowerCase(),I=/Android|webOS|iPhone|iPod|BlackBerry|iPad/i.test(j),k=function(){try{return-1!==window._parent.location.search.indexOf("from=wxminiprogram")}catch(e){return!1}}();var O=0,_=new Set;function x(e){return O+=1,!e&&function(e){_.forEach(function(t){return t(e)})}(O),O}function S(e,o){var i,c=this,u=o.Events,l=o.Enum,p=o.Props,f=p[0],v=p[1],b={objId:O};switch(function e(n,r,a){var o=r.slice(0);var i=function(){var r=o.shift();!r.alias&&~E.indexOf(r.prop)&&o.push(t(t({},r),{alias:r.prop+"Async"})),Object.defineProperty(n,r.alias||r.prop,{get:function(){var o=this,i=1===r.cache,s=i&&this["__"+r.prop+"CacheValue"];if(!s){var c=new Error(""),u=c.stack.split("\n").slice(2).join("\n"),l=x(i),p=function(){for(var e,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];void 0!==r.caller?function e(n,r,a){var o=r.slice(0);var i=function(){var r=o.shift();!r.alias&&~E.indexOf(r.prop)&&o.push(t(t({},r),{alias:r.prop+"Async"})),Object.defineProperty(n,r.alias||r.prop,{get:function(){var t=this,o=1===r.cache,i=o&&this["__"+r.prop+"CacheValue"];if(!i){var s=new Error(""),c=s.stack.split("\n").slice(2).join("\n"),u=x(o),l=function(){for(var t,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];void 0!==r.caller?e(t={objId:x()},a[r.caller],a):t={};return N(l,t,"api.caller",{obj:l,args:o,parentObjId:n.objId,objId:t.objId,prop:r.prop},c),t};return l.objId=-1,void 0!==r.getter&&(l.objId=u,e(l,a[r.getter],a)),N(n,l,"api.getter",{parentObjId:n.objId,objId:l.objId,prop:r.prop},c,function(){delete t["__"+r.prop+"CacheValue"]}),o&&(this["__"+r.prop+"CacheValue"]=l),l}return i},set:function(e){var t=new Error(""),a=t.stack.split("\n").slice(2).join("\n");return N(n,{},"api.setter",{value:e,parentObjId:n.objId,objId:-1,prop:r.prop},a)}})};for(;o.length;)i()}(e={objId:x()},a[r.caller],a):e={};return N(p,e,"api.caller",{obj:p,args:o,parentObjId:n.objId,objId:e.objId,prop:r.prop},u),e};return p.objId=-1,void 0!==r.getter&&(p.objId=l,e(p,a[r.getter],a)),N(n,p,"api.getter",{parentObjId:n.objId,objId:p.objId,prop:r.prop},u,function(){delete o["__"+r.prop+"CacheValue"]}),i&&(this["__"+r.prop+"CacheValue"]=p),p}return s},set:function(e){var t=new Error(""),a=t.stack.split("\n").slice(2).join("\n");return N(n,{},"api.setter",{value:e,parentObjId:n.objId,objId:-1,prop:r.prop},a)}})};for(;o.length;)i()}(b,f,v),b.Events=u,b.Enum=l,e.Enum=b.Enum,e.Events=b.Events,g(e.url)){case a.writer:e.WordApplication=e.WpsApplication=function(){return b};break;case a.spreadsheet:e.ExcelApplication=e.EtApplication=function(){return b};break;case a.presentation:e.PPTApplication=e.WppApplication=function(){return b};break;case a.pdf:e.PDFApplication=function(){return b}}e.Application=b,e.Free=function(e){return h("api.free",{objId:e},"")},e.Stack=b.Stack=(i=function(t){e&&e.Free(t)},function(){var e=[],t=function(t){e.push(t)};return _.add(t),{End:function(){i(e),_.delete(t)}}});var m={};s.add(function(e){return n(c,void 0,void 0,function(){var t,n,a,o,i;return r(this,function(r){switch(r.label){case 0:return"api.event"===(t=s.parse(e.data)).eventName&&t.data?(n=t.data,a=n.eventName,o=n.data,n.objIds,(i=m[a])?[4,i(o)]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}),b.Sub={},Object.values(u).forEach(function(e){Object.defineProperty(b.Sub,e,{set:function(t){m[e]=t,d({eventName:"api.event.register",data:{eventName:e,register:!!t,objId:O+=1}})}})})}var E=["ExportAsFixedFormat","GetOperatorsInfo","ImportDataIntoFields","ReplaceText","ReplaceBookmark","GetBookmarkText","GetComments"];function T(e,n,r){var a=n.slice(0);var o=function(){var n=a.shift();if(!n.alias&&~E.indexOf(n.prop)){a.push(t(t({},n),{alias:n.prop+"Async"}))}Object.defineProperty(e,n.alias||n.prop,{get:function(){var t=this;var a=n.cache===1;var o=a&&this["__"+n.prop+"CacheValue"];if(!o){var i=new Error("");var s=i.stack.split("\n").slice(2).join("\n");var c=x(a);var u=function(){for(var t=[],a=0,o;a<arguments.length;a++){t[a]=arguments[a]}if(n.caller!==undefined){o={objId:x()};T(o,r[n.caller],r)}else{o={}}return N(l,o,"api.caller",{obj:l,args:t,parentObjId:e.objId,objId:o.objId,prop:n.prop},s),o};var l=u;l.objId=-1;if(n.getter!==undefined){l.objId=c;T(l,r[n.getter],r)}N(e,l,"api.getter",{parentObjId:e.objId,objId:l.objId,prop:n.prop},s,function(){delete t["__"+n.prop+"CacheValue"]});if(a){this["__"+n.prop+"CacheValue"]=l}return l}return o},set:function(t){var r=new Error("");var a=r.stack.split("\n").slice(2).join("\n");return N(e,{},"api.setter",{value:t,parentObjId:e.objId,objId:-1,prop:n.prop},a)}})};while(a.length){o()}}function N(e,t,n,r,a,o){var i,s=(e.done?e.done():Promise.resolve()).then(function(){return i||(i=h(n,r,a,o)),i});t.done=function(){return s},t.then=function(e,n){return r.objId>=0?(t.then=null,t.catch=null,e(t)):s.then(e,n)},t.catch=function(e){return s.catch(e)},t.Destroy=function(){return h("api.free",{objId:t.objId},"")}}var C=null,P={fileOpen:"fileOpen",tabSwitch:"tabSwitch",fileSaved:"fileSaved",fileStatus:"fileStatus",error:"error",stage:"stage"},A={getToken:"api.getToken",onToast:"event.toast"};function L(e,a,o,i,c){var u=this;void 0===o&&(o={});s.add(function(l){return n(u,void 0,void 0,function(){var n,u,p,f,v,b,h,m,w;return r(this,function(r){switch(r.label){case 0:return n=s.parse(l.data),u=n.eventName,p=void 0===u?"":u,f=n.data,v=void 0===f?null:f,b=n.url,h=void 0===b?null:b,-1!==["wps.jssdk.api"].indexOf(p)?[2]:"ready"!==p?[3,1]:(d({eventName:"setConfig",data:t(t({},o),{version:e.version})}),e.tokenData&&e.setToken(e.tokenData),c.apiReadySended&&d({eventName:"api.ready"}),e.iframeReady=!0,[3,9]);case 1:return"error"!==p?[3,2]:(a.emit(P.error,v),[3,9]);case 2:return"open.result"!==p?[3,3]:(a.emit(P.fileOpen,v),[3,9]);case 3:return"file.saved"!==p?[3,4]:(a.emit(P.fileStatus,v),a.emit(P.fileSaved,v),[3,9]);case 4:return"tab.switch"!==p?[3,5]:(a.emit(P.tabSwitch,v),[3,9]);case 5:return"api.scroll"!==p?[3,6]:(window.scrollTo(v.x,v.y),[3,9]);case 6:return p!==A.getToken?[3,8]:(m=d,w={eventName:A.getToken+".reply"},[4,c.refreshToken()]);case 7:return m.apply(void 0,[(w.data=r.sent(),w)]),[3,9];case 8:p===A.onToast?c.onToast(v):"stage"===p?a.emit(P.stage,v):"event.callback"===p?a.emit(v.eventName,v.data):"api.ready"===p&&S(e,v),r.label=9;case 9:return"function"==typeof i[p]&&i[p](e,h||v),[2]}})})})}function B(e){return new Promise(function(t){var n=function(r){s.parse(r.data).eventName===e&&(t(),s.remove(n))};s.add(n)})}function D(e){void 0===e&&(e={}),C&&C.destroy();try{var t=w(e),a=t.subscriptions,o=void 0===a?{}:a,i=t.mount,c=void 0===i?null:i,u=t.url,l=t.refreshToken,f=t.onToast,h=p(u,c),m=B("ready"),g=B("api.ready");delete t.mount,u&&delete t.url,delete t.subscriptions;var j=(k=k||Object.create(null),{on:function(e,t){(k[e]||(k[e]=[])).push(t)},off:function(e,t){k[e]&&k[e].splice(k[e].indexOf(t)>>>0,1)},emit:function(e,t){(k[e]||[]).slice().map(function(e){e(t)}),(k["*"]||[]).slice().map(function(n){n(e,t)})}}),I={apiReadySended:!1};return C={url:u,iframe:h,version:"1.1.3",iframeReady:!1,tokenData:null,commandBars:null,tabs:{getTabs:function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,m];case 1:return e.sent(),[2,b({api:"tab.getTabs"})]}})})},switchTab:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,m];case 1:return t.sent(),[2,b({api:"tab.switchTab",args:{tabKey:e}})]}})})}},setCooperUserColor:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,m];case 1:return t.sent(),[2,b({api:"setCooperUserColor",args:e})]}})})},setToken:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,m];case 1:return t.sent(),C.tokenData=e,d({eventName:"setToken",data:e}),[2]}})})},ready:function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return I.apiReadySended||(I.apiReadySended=!0,d({eventName:"api.ready"})),[4,g];case 1:return e.sent(),[4,new Promise(function(e){return setTimeout(e,0)})];case 2:return e.sent(),[2]}})})},destroy:function(){h.destroy(),s.empty(),C=null,_=new Set,O=0},save:function(){return n(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,m];case 1:return e.sent(),[2,v({api:"save"})]}})})},setCommandBars:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,m];case 1:return t.sent(),y(e),[2]}})})},updateConfig:function(e){return void 0===e&&(e={}),n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,m];case 1:return t.sent(),e.commandBars?(console.warn("Deprecated: `updateConfig()` 方法即将废弃，请使用`setCommandBars()`代替`updateConfig()`更新`commandBars`配置。"),[4,y(e.commandBars)]):[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},executeCommandBar:function(e){return n(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,m];case 1:return t.sent(),y([{cmbId:e,attributes:[{name:"click",value:!0}]}]),[2]}})})},on:function(e,t){e===P.fileSaved&&console.warn("fileSaved事件监听即将弃用， 推荐使用fileStatus进行文件状态的监听"),j.on(e,t)}},function(e,t,n,r){t&&"[object Function]"==={}.toString.call(t)&&(r.refreshToken=t,e.refreshToken={eventName:A.getToken});n&&"[object Function]"==={}.toString.call(n)&&(r.onToast=n,e.onToast={eventName:A.onToast})}(t,l,f,I),L(C,j,t,o,I),C}catch(e){console.error(e)}var k}console.log("WebOfficeSDK JS-SDK V1.1.3");var R=Object.freeze({__proto__:null,listener:L,config:D});window.WPS=R;var V=D,W={config:V};e.config=V,e.default=W,Object.defineProperty(e,"__esModule",{value:!0})});
