define(function(){var kkApi={_cacheId:0,_cachePrefix:"_device_context_",_caches:{},_generateCacheId:function(){this._cacheId=this._cacheId+1;return this._cachePrefix+this._cacheId},device_execute:function(cacheId,methodName,params){if(this._caches[cacheId]!=null){this._caches[cacheId][methodName](cacheId,params)}},_appCallback:function(signStr,cacheObj){var cacheId=this._generateCacheId();var apiUrl="kkapi://"+signStr;var extArgu="";if(cacheObj!=null){this._caches[cacheId]=cacheObj;apiUrl+="?cacheId="+cacheId;extArgu=this._formatArgu(cacheObj)}var rtnStr=window.prompt(apiUrl,extArgu);if(rtnStr!=null&&rtnStr!=""){var rtnObj=this.formatJson(rtnStr);if(rtnObj.status==1){if(window.console){window.console.log(signStr+"调用成功，返回信息为："+rtnObj.message)}return{result:rtnObj.message}}else{if(rtnObj.status==0){if(window.console){window.console.error(signStr+"调用失败，错误信息为："+rtnObj.message)}this.clearCache(cacheId)}else{if(rtnObj.status==-1){if(window.console){window.console.error(signStr+"接口，当前客户端暂不支持。")}this.clearCache(cacheId)}}}}return null},formatJson:function(jsonStr){var rtnObj=null;if(window.JSON){rtnObj=JSON.parse(jsonStr)}else{if(rtnStr.parseJSON){rtnObj=jsonStr.parseJSON()}else{rtnObj=eval("("+jsonStr+")")}}return rtnObj},_formatArgu:function(jsonObj){var extArgu="";for(var key in jsonObj){if(typeof(jsonObj[key])=="string"){extArgu+="&"+key+"="+window.encodeURIComponent(jsonObj[key])}else{if(typeof(jsonObj[key])=="array"){var vlas=jsonObj[key];for(var i=0;i<vlas.length;i++){extArgu+="&"+key+"="+window.encodeURIComponent(vlas[i])}}else{if(typeof(jsonObj[key])=="function"){}else{extArgu+="&"+key+"="+window.encodeURIComponent(jsonObj[key])}}}}return extArgu},clearCache:function(cacheId){if(this._caches[cacheId]!=null){delete this._caches[cacheId]}},closeWindow:function(){return this._appCallback("closeWindow")},showTitleBar:function(isShow){return this._appCallback("showTitleBar",{show:isShow})},_canGoBack:function(){var res=this._appCallback("canGoBack");if(res!=null){return res.result}return null},goBack:function(){var rtn=null;var canBack=this._canGoBack();if(canBack==true){rtn=this._appCallback("goBack")}else{if(canBack==false){rtn=this.closeWindow()}else{rtn=null}}return rtn},goForward:function(){return this._appCallback("goForward")},getUserID:function(){var res=this._appCallback("getUserID");if(res!=null){return res.result}return null},openSpeech:function(options){return this._appCallback("openSpeech",options)},openCamera:function(options){return this._appCallback("openCamera",options)},selectFile:function(options){return this._appCallback("selectFile",options)},uploadFile:function(options){return this._appCallback("uploadFile",options)},playSpeech:function(voiceUrl){var _self=this;this._appCallback("playSpeech",{downloadurl:voiceUrl,complete:function(cacheId){_self.clearCache(cacheId)},cancel:function(cacheId){_self.clearCache(cacheId)},error:function(cacheId,msg){if(window.console){window.console.error("语音播放错误:"+msg)}_self.clearCache(cacheId)}});return{}},captureScreen:function(options){return this._appCallback("captureScreen",options)},readAsDataURL:function(file){return this._appCallback("readAsDataURL",file)}};window.kkApi=kkApi;return kkApi});