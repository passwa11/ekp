require({cache:{"sys/mobile/js/mui/ocr/OcrConstants":function(){define(["dojo/_base/declare"],function(a){return a("mui.ocr.OcrConstants",null,{OCR_EVENT_IDENTIFY_SUCCESS:"ocr_identify_success",OCR_EVENT_IDENTIFY_FAIL:"ocr_identify_fail",OCR_EVENT_REUPLOAD:"ocr_reUpload",OCR_EVENT_CANCEL:"ocr_cancel",OCR_EVENT_ONLY_UPLOAD:"ocr_only_upload",OCR_EVENT_OPT_VIEWIMG:"ocr_opt_viewImg",OCR_EVENT_OPT_REPLACEIMG:"ocr_opt_replaceImg",OCR_EVENT_OPT_CANCEL:"ocr_opt_cancel",OCR_EVENT_FAIL_CANCEL:"ocr_fail_cancel"})})},"sys/mobile/js/mui/ocr/Ocr":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_Contained","dijit/_Container","mui/ocr/_OcrMixin","mui/form/_AlignMixin","dojo/dom-construct","dojo/dom-class","dojo/dom-attr","dojo/query","dojo/html","dojo/_base/lang","dojo/on","mui/util","dojox/mobile/viewRegistry","mui/i18n/_i18n!sys/mobile/js/mui/mui-common"],function(g,f,a,j,c,p,e,o,m,l,i,b,k,h,n,d){return g("mui.ocr.Orc",[a,j,f,c,p],{containerClass:"muiOcrContainer",certificateType:"",typeNum:"",front:"1",isUpload:true,tmpUrl:"/sys/mobile/js/mui/ocr/default/ocr_default.jsp",tmpUrlParams:"front=!{front}&isUpload=!{isUpload}&ocrDesc=!{ocrDesc}&ocrTip=!{ocrTip}&showStatus=!{showStatus}",identifyUrl:"/third/ocr/thirdOcrPart.do?method=ocrPartRecogniz",failJsp:"/sys/mobile/js/mui/ocr/ocr_fail.jsp",failJspParams:"isUpload=!{isUpload}",operDialogJspUrl:"/sys/mobile/js/mui/ocr/ocr_opt.jsp",operDialogJspUrlParams:"showStatus=!{showStatus}",showFlag:false,fdKey:"",showStatus:"",align:"left",toIdentify:true,attSize:0,required:false,buildRendering:function(){this.isForm=true;this.inherited(arguments);this.buildInnerRendering()},postCreate:function(){this.inherited(arguments);if(this.showStatus=="edit"){this.bindEvents()}},startup:function(){this.inherited(arguments);o.add(this.domNode,"muiOcr");this.setNodeAlign();this.setValidator()},setNodeAlign:function(){o.add(this.domNode,"muiOcr"+this.align.substring(0,1).toUpperCase()+this.align.substring(1))},setValidator:function(){this.pView=this.getValidateView();if(!this.pView||this.showStatus!="edit"){return}var q=this;var r="";if(this.required){this.requiredNode=e.create("div",{className:"muiFormRequired muiFormRequiredShow muiOcrImgRequired",innerHTML:"*"},this.ocrContainerNode);this.pView._validation.addValidator("ocr_image_required_"+this.fdKey,d["mui.ocr.validator.pic.null"],function(){return q.validateOcrImgRequired()});r+="ocr_image_required_"+this.fdKey}if(r){m.set(this.domNode,"validate",r)}},validateOcrImgRequired:function(){if(this.showFlag==true){return true}else{return false}},reValidate:function(){if(this.pView){this.pView._validation.validateElement(this.domNode)}},getValidateView:function(r){var s=this.domNode||r;var q=n.getEnclosingView(s);while(q!=null&&!q._validation){q=n.getParentView(q)}return q},buildInnerRendering:function(){var s=this.tmpUrl;if(s.indexOf("?")==-1){s+="?"+this.tmpUrlParams}s=h.formatUrl(h.urlResolver(s,this));if(s){var r=this.containerClass;if(this.required){r+=" muiOcrRequiredContainer"}this.ocrContainerNode=e.create("div",{className:r},this.domNode);if(this.showStatus=="edit"||this.attSize>0||this.isUpload==false){var q=this;require({async:false},["dojo/text!"+s],function(u){var t=new i._ContentSetter({node:q.ocrContainerNode,parseContent:true,cleanContent:true,onBegin:function(){this.content=b.replace(this.content,{categroy:q});this.inherited("onBegin",arguments)}});t.set(u);t.parseDeferred.then(function(v){q.parseResults=v;if(!q.imgNode){q.imgNode=l("[clickEvent='selectImg']",q.ocrContainerNode)[0]}});t.tearDown()})}}},bindEvents:function(){if(this.imgNode){k(this.imgNode,"click",b.hitch(this,this.selectImg))}}})})},"sys/mobile/js/mui/ocr/OcrButton":function(){define(["dojo/_base/declare","dijit/_WidgetBase","mui/ocr/OcrConstants","dojo/topic"],function(c,b,d,a){return c("mui.ocr.OcrButton",[b,d],{html:"",type:"",fdKey:"",buildRendering:function(){this.inherited(arguments);this.domNode.innerHTML=this.html||""},postCreate:function(){this.inherited(arguments);this.connect(this.domNode,"click","_todo")},_todo:function(){if(this.type=="cancel"||this.type=="opt_del"){a.publish(this.OCR_EVENT_CANCEL+this.fdKey,this)}else{if(this.type=="reUpload"||this.type=="opt_reUpload"){a.publish(this.OCR_EVENT_REUPLOAD+this.fdKey,this)}else{if(this.type=="onlyUpload"){a.publish(this.OCR_EVENT_ONLY_UPLOAD+this.fdKey,this)}else{if(this.type=="opt_viewImg"){a.publish(this.OCR_EVENT_OPT_VIEWIMG+this.fdKey,this)}else{if(this.type=="opt_replaceImg"){a.publish(this.OCR_EVENT_OPT_REPLACEIMG+this.fdKey,this)}else{if(this.type=="opt_cancel"){a.publish(this.OCR_EVENT_OPT_CANCEL+this.fdKey,this)}else{if(this.type=="fail_cancel"){a.publish(this.OCR_EVENT_FAIL_CANCEL+this.fdKey,this)}}}}}}}}})})},"sys/mobile/js/mui/ocr/_OcrMixin":function(){define(["dojo/_base/declare","sys/mobile/js/mui/ocr/OcrConstants","mui/util","mui/dialog/Dialog","mui/dialog/Tip","mui/dialog/Modal","dojo/request","dojo/topic","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/query","dojo/on","mui/i18n/_i18n!sys/mobile/js/mui/mui-common"],function(f,a,h,k,o,l,e,g,b,d,i,n,m,j,c){return f("mui.ocr._OcrMixin",[a],{postCreate:function(){this.inherited(arguments);this.subscribe("attachmentObject_"+this.fdKey+"_start","uploadStart");this.subscribe("attachmentObject_"+this.fdKey+"_success","uploadSuccess");this.subscribe("attachmentObject_"+this.fdKey+"_fail","uploadError");this.subscribe("attachmentObject_"+this.fdKey+"_afterView","_createImg");this.subscribe(this.OCR_EVENT_REUPLOAD+this.fdKey,"reUpload");this.subscribe(this.OCR_EVENT_ONLY_UPLOAD+this.fdKey,"onlyUpload");this.subscribe(this.OCR_EVENT_CANCEL+this.fdKey,"cancelIdentify");this.subscribe(this.OCR_EVENT_OPT_VIEWIMG+this.fdKey,"viewImg");this.subscribe(this.OCR_EVENT_OPT_REPLACEIMG+this.fdKey,"replaceImg");this.subscribe(this.OCR_EVENT_OPT_CANCEL+this.fdKey,"hideOptDialog");this.subscribe(this.OCR_EVENT_FAIL_CANCEL+this.fdKey,"hideFailDialog")},selectImg:function(q){var p=this.showFlag;if(q&&q.showFlag==false){p=false}if(p){this.showOperations()}else{g.publish("attachmentOptListItem_emit_events",this,{eventType:"click",targetName:"uploadDom",key:this.fdKey})}},showOperations:function(){var p=this;var q=this.operDialogJspUrl;if(q.indexOf("?")==-1){q+="?"+this.operDialogJspUrlParams}q=h.formatUrl(h.urlResolver(q,this));require({async:false},["dojo/text!"+q],function(r){r=b.replace(r,{categroy:p});p.dialogDom=d.toDom(r);p.optDialog=k.element({canClose:false,showClass:"muiOcrOptDialog",element:p.dialogDom,position:"bottom",scrollable:false,parseable:true,callback:b.hitch(p,function(){p.optDialog=null}),onDrawed:function(){}})})},uploadStart:function(p,q){this.delItem();if(this.isUpload){this.showUploadStatus()}if(!this.isUpload){this.showProcess()}},uploadSuccess:function(p,q){this.hideUploadStatus();if(this.isUpload){this.showImg(p,q);this.showFlag=true}if(this.toIdentify){this.identify(p,q)}this.toIdentify=true;this.reValidate()},uploadError:function(q,p){this.showFlag=false;if(!this.isUpload){this.hideProcess();o.fail({text:c["mui.ocr.identify.success.tip"]})}},identify:function(s,t){if(this.isUpload){this.showProcess()}this.beforeIdentify(t.file,s);var q=this.identifyUrl;var r=t.file;this.attData=t;var u={};u.type=this.typeNum||"0";u.attId=this.attId||"";u.modelName="";u.formName="";u.docId="";q=h.formatUrl(h.urlResolver(q));var p=this;e(q,{data:u,handleAs:"json",sync:true,method:"POST"}).then(function(v){p.identifySuccess(v);p.afterIdentify(s)},function(v){p.identifyError(v);p.afterIdentify(s)})},identifySuccess:function(q){var p=this.callbackAfterIdentifySuccess(q);this.hideFailTip();this.hideProcess();if(p){o.success({text:c["mui.ocr.identify.success.tip"]})}else{this.identifyError()}g.publish(this.OCR_EVENT_IDENTIFY_SUCCESS+this.fdKey,this,q)},callbackAfterIdentifySuccess:function(p){},identifyError:function(p){this.showFailTip();this.hideProcess();this.callbackAfterIdentifyError();g.publish(this.OCR_EVENT_IDENTIFY_FAIL+this.fdKey,this)},callbackAfterIdentifyError:function(q){var s=c["mui.ocr.identify.fail.dialog.title"];if(!this.isUpload){this.delItem();s=c["mui.ocr.identify.fail.tip"]}var p=this;var r=this.failJsp;if(r.indexOf("?")==-1){r+="?"+this.failJspParams}var r=h.formatUrl(h.urlResolver(r,this));require({async:false},["dojo/text!"+r],function(v){v=b.replace(v,{categroy:p});var u=v;var t=[];p.failDialog=l(u,s,t);p.failDialog.destroyAfterClose=true})},beforeIdentify:function(s,r){if(s){var p=window.AttachmentList[this.fdKey]||r;if(p!=null&&p.fileStatus!=-1){var t=p.fdModelId;var q=p.fdModelName;p.fdModelId="";p.fdModelName="";this.attId=p.registFile({filekey:s.filekey,name:s.name});p.fdModelId=t;p.fdModelName=q}}},afterIdentify:function(r){if(this.attId){var q=window.AttachmentList[this.fdKey]||r;if(q!=null){var p={fdId:this.attId};e.post(q.deleteUrl,{data:p,sync:true}).then(function(s){console.info("删除成功！")},function(){console.info("删除失败！")})}}},onlyUpload:function(){this.hideFailDialog()},cancelIdentify:function(){this.hideFailDialog();this.delItem()},delItem:function(){if(this.isUpload){this.hideFailTip();this.hideFailDialog();this.hideOptDialog();this.deleteImg();this.showFlag=false}this.reValidate();g.publish("attachmentEditListItem_delItem",this,{key:this.fdKey})},viewImg:function(){this.hideOptDialog();g.publish("attachmentListItem_viewItem",this,{key:this.fdKey})},reUpload:function(){this.hideOptDialog();this.hideFailDialog();this.selectImg({showFlag:false})},replaceImg:function(){this.toIdentify=false;this.hideOptDialog();this.selectImg({showFlag:false})},showImg:function(r,p){if(p&&p.file){var q=p.file;this.createImg(q)}},createImg:function(p){if(this.imgNode){this.deleteImg();n.add(this.imgNode,"muiOcrNoBackground");this.imageNode=d.create("img",{className:"muiOcrDefaultImg",align:"middle",src:h.formatUrl(p.href)},this.imgNode)}},_createImg:function(p,q){if(q&&this.isUpload==true){this.createImg(q);if(q.pageType&&q.pageType=="edit"){this.showFlag=true}else{j(this.imageNode,"click",b.hitch(this,this.viewImg))}}},deleteImg:function(){if(this.imageNode){d.destroy(this.imageNode);this.imageNode=null;n.remove(this.imgNode,"muiOcrNoBackground")}},hideFailTip:function(){var p=m(".muiOcrDefaultFail",this.domNode)[0];if(p){i.set(p,{display:"none"})}},showFailTip:function(){var p=m(".muiOcrDefaultFail",this.domNode)[0];if(p){i.set(p,{display:""})}},hideOptDialog:function(){if(this.optDialog){this.optDialog.hide();this.optDialog=null}},hideFailDialog:function(){if(this.failDialog){this.failDialog.hide();this.failDialog=null}},showProcess:function(){if(!this._processing){var p=c["mui.ocr.identify.process"];this._processing=o.progressing({text:p});this._processing.show()}},hideProcess:function(){if(this._processing){this._processing.hide();this._processing=null}},showUploadStatus:function(){this.statusDiv=d.create("div",{className:"muiAttItemStatus"},this.imgNode);d.create("i",{className:"fontmuis mui-spin muis-refresh"},this.statusDiv)},hideUploadStatus:function(){if(this.statusDiv){d.destroy(this.statusDiv);this.statusDiv=null}}})})}}});require({cache:{"sys/mobile/js/mui/mui-ocr_zh-cn._min_":function(){define("",{})}}});